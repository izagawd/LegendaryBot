@using PublicInfo
@using Website.Services
@inject WebsiteThemeService WebsiteThemeService
@inject NavigationManager NavMan

@code {

    [CascadingParameter] public Task<AuthenticationState> AuthState { get; set; } = null!;
    [CascadingParameter] public WebsiteTheme WebsiteTheme { get; set; }
    [Parameter] public RenderFragment? ChildContent { get; set; }
    private bool _showMore = false;
    private string TextColor => WebsiteTheme == WebsiteTheme.Dark ? "white" : "black";
    private string IconHovBgColorClass => WebsiteTheme == WebsiteTheme.Dark ? "icon-clickable-dark" : "icon-clickable-light";

    private class DirectoryStorer

    {
        public string Name { get; }
        public string Directory { get; }
        public string Icon { get; }
        public Func<string, bool>? IsDirUse { get; }

        public DirectoryStorer(string name, string directory, string icon, Func<string, bool>? isDirectoryUse = null)
        {
            IsDirUse = isDirectoryUse;
            Name = name;
            Directory = directory;
            Icon = icon;
        }
    }

    private readonly List<DirectoryStorer> Directories =
    [
        new DirectoryStorer("Home", "/", "home", str => str == Information.WebsiteDomainName || str == Information.WebsiteDomainName + "/"),
        new DirectoryStorer("Inventory", "/inventory/characters", "backpack",
            str => str.StartsWith(Information.WebsiteDomainName + "/inventory", StringComparison.CurrentCultureIgnoreCase)),
        new DirectoryStorer("Guild Settings", "/guild", "star"),
        new DirectoryStorer("Teams", "/teams", "groups")
    ];

    protected override async Task OnInitializedAsync()
    {
        if ((await AuthState).User.Identity?.IsAuthenticated ?? false)
        {
            Directories.Add(new DirectoryStorer("Logout", "/authentication/logout", "logout"));
        }
        else
        {
            Directories.Add(new DirectoryStorer("Login", "/authentication/login", "login"));
        }
    }

}

<HeadContent>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0"/>
</HeadContent>
<div class="navigator-outer @(WebsiteTheme == WebsiteTheme.Dark ? "navigator-outer-dark" : "navigator-outer-light")" style="background-color: @WebsiteTheme.GetThemeDefaults().DefaultBackgroundColor;">
    <div class="navigator-container  @(_showMore ? "show-more" : "")" style="border-color: @(WebsiteTheme == WebsiteTheme.Dark ? "darkgray" : "black")">
        <div class="navigator-inner">
            <p style="color: @TextColor;">Legendary!!</p>
        </div>
        @{
            var or = 2;
            var backgroundCol = "white";
            if (WebsiteThemeService.WebsiteTheme == WebsiteTheme.Light)
                backgroundCol = "black";
        }
        @foreach (var i in Directories)
        {
            bool isDom;
            if (i.IsDirUse is not null)
            {
                isDom = i.IsDirUse(NavMan.Uri);
            }
            else
            {
                isDom = NavMan.Uri.StartsWith(Information.WebsiteDomainName + i.Directory,
                    StringComparison.CurrentCultureIgnoreCase);
            }

            <div style="order: @(or++)" class="link-container icon-clickable  @IconHovBgColorClass">

                <div style="background-color: @(isDom ? backgroundCol : "inherit"); height: 100%; width: 5px"></div>
                <a href="@i.Directory" class="link-a">
                    <span class="material-symbols-outlined nav-link-icon" style="color: @(WebsiteTheme == WebsiteTheme.Dark ? "white" : "black")">
                        @i.Icon
                    </span>
                    <p style="color: @TextColor">@i.Name</p>
                </a>
            </div>
        }
        <div class="additional-cont">
            <div class="icon-clickable dark-mode-changer-div @IconHovBgColorClass" @onclick="() => { if (WebsiteTheme == WebsiteTheme.Dark) WebsiteThemeService.WebsiteTheme = WebsiteTheme.Light;else WebsiteThemeService.WebsiteTheme = WebsiteTheme.Dark; }">
                <span class="material-symbols-outlined toggle-button" style="color: @(WebsiteTheme == WebsiteTheme.Dark ? "white" : "black")">
                    dark_mode
                </span>
            </div>

            <div class="menu-div icon-clickable @IconHovBgColorClass"
                 @onclick="() => _showMore = !_showMore">
                <span class="material-symbols-outlined toggle-button" style="color: @(WebsiteTheme == WebsiteTheme.Dark ? "white" : "black")">
                    menu
                </span>
            </div>
        </div>

    </div>

    @if (ChildContent is not null)
    {
        <div class="child-content-stuff">
            @ChildContent
        </div>
    }


</div>